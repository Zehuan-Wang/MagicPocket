from sklearn.cluster import AgglomerativeClustering
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np
from scipy.cluster.hierarchy import linkage
from scipy.spatial.distance import pdist, squareform


def hierarcy_clustering(dataList, distance_threshold: float):
    # 提取vectors
    vectors = np.array([data['vector'] for data in dataList])

    # 计算余弦相似度
    cosine_sim = cosine_similarity(vectors)

    # 转换为距离矩阵
    distance_matrix = 1 - cosine_sim

    # 使用层次聚类
    model = AgglomerativeClustering(distance_threshold=distance_threshold, n_clusters=None)

    labels = model.fit_predict(distance_matrix)

    # 获取所有唯一标签
    unique_labels = np.unique(labels)

    # 创建一个字典，存储每个标签对应的索引列表
    label_indices = {int(label): [] for label in unique_labels}

    # 遍历标签，将索引添加到对应的列表中
    for index, label in enumerate(labels):
        label_indices[int(label)].append(int(index))

    # 输出结果
    return label_indices



if __name__ == "__main__":
    recordsList = {
        "data": [
            {
                "id": 0,
                "comment": "",
                "context": "string",
                "vector": [
                    0.042404305189847946,
                    0.08744265884160995,
                    -0.023802509531378746,
                    -0.016075924038887024,
                    -0.16664724051952362,
                    0.042756445705890656,
                    0.1473986953496933,
                    0.06657722592353821,
                    0.02157033048570156,
                    -0.05534940958023071,
                    0.027306221425533295,
                    -0.048701412975788116,
                    0.015198642387986183,
                    -0.02380780316889286,
                    -0.028474245220422745,
                    0.01992400735616684,
                    -0.046119242906570435,
                    -0.04783831536769867,
                    -0.09889523684978485,
                    -0.06327953189611435,
                    -0.0018107740906998515,
                    0.03322463110089302,
                    -0.054301343858242035,
                    0.027211513370275497,
                    0.028918130323290825,
                    0.0516970157623291,
                    -0.018772892653942108,
                    0.045449040830135345,
                    0.04876725748181343,
                    -0.035673730075359344,
                    0.013105509802699089,
                    -0.04061577469110489,
                    0.050657182931900024,
                    -0.004559475462883711,
                    -0.002562277251854539,
                    0.033924687653779984,
                    -0.08652587980031967,
                    -0.020092202350497246,
                    0.030838195234537125,
                    -0.00010088953422382474,
                    -0.025124240666627884,
                    -0.1094924733042717,
                    -0.0015939139993861318,
                    0.010045232251286507,
                    -0.015325390733778477,
                    0.019454963505268097,
                    -0.02492389641702175,
                    0.07296505570411682,
                    0.0322304293513298,
                    -0.029915791004896164,
                    0.039209213107824326,
                    -0.059747498482465744,
                    -0.08395792543888092,
                    0.0027713440358638763,
                    0.045525677502155304,
                    0.04755764827132225,
                    0.01398697029799223,
                    0.045169126242399216,
                    0.00997585617005825,
                    0.024504205211997032,
                    0.027806805446743965,
                    -0.011337457224726677,
                    -0.048058975487947464,
                    0.024236969649791718,
                    0.03628172352910042,
                    -0.05683748424053192,
                    0.03408427909016609,
                    -0.011268246918916702,
                    -0.04815525561571121,
                    -0.041554905474185944,
                    -0.03455384820699692,
                    0.03830869495868683,
                    -0.013503787107765675,
                    0.09394857287406921,
                    0.009942948818206787,
                    0.009857656434178352,
                    0.026507841423153877,
                    -0.0560419037938118,
                    0.12046144157648087,
                    0.06611191481351852,
                    -0.004236794542521238,
                    -0.07524192333221436,
                    -0.019593369215726852,
                    0.04483906179666519,
                    -0.0004949845024384558,
                    0.04035588726401329,
                    -0.019720425829291344,
                    0.08981690555810928,
                    -0.019750233739614487,
                    0.009842757135629654,
                    -0.03511496260762215,
                    -0.057533491402864456,
                    0.05567537248134613,
                    -0.026997093111276627,
                    -0.06108061596751213,
                    0.03637691214680672,
                    -0.04511083662509918,
                    -0.04743402078747749,
                    -0.055632732808589935,
                    0.2011895626783371,
                    -0.0026269659865647554,
                    0.011122262105345726,
                    0.08598620444536209,
                    -0.001961279194802046,
                    -0.07940459996461868,
                    0.013762418180704117,
                    0.027504295110702515,
                    -0.01910639926791191,
                    0.056582506746053696,
                    -0.05290161445736885,
                    -0.028379123657941818,
                    -0.007141449023038149,
                    -0.0027295337058603764,
                    0.0038808321114629507,
                    -0.0431072860956192,
                    -0.053314536809921265,
                    0.004853667691349983,
                    0.017002416774630547,
                    0.026844076812267303,
                    0.07009437680244446,
                    0.03907538950443268,
                    -0.04873126745223999,
                    -0.08236613869667053,
                    0.006413530092686415,
                    -0.11345602571964264,
                    -0.03931736201047897,
                    0.0458100400865078,
                    -4.436033194017131e-33,
                    -0.0030483657028526068,
                    0.03888144716620445,
                    0.03598437085747719,
                    -0.046431612223386765,
                    -0.01508016511797905,
                    -0.01483298372477293,
                    -0.08468125015497208,
                    0.05588186904788017,
                    -0.015728963539004326,
                    0.006570192985236645,
                    -0.02863921783864498,
                    -0.03977593779563904,
                    0.04534465819597244,
                    -0.07065574824810028,
                    0.06225140392780304,
                    -0.07123400270938873,
                    0.08931880444288254,
                    0.030225273221731186,
                    -0.01539179589599371,
                    -0.031103026121854782,
                    -0.05965300649404526,
                    0.09098485857248306,
                    0.047184836119413376,
                    -0.03973284363746643,
                    -0.03329121693968773,
                    -0.04687974229454994,
                    0.013752236030995846,
                    -0.08410052210092545,
                    0.03390265628695488,
                    0.0015482782619073987,
                    0.007306323386728764,
                    -0.09746073186397552,
                    -0.00763252517208457,
                    0.021246710792183876,
                    0.043111927807331085,
                    0.0015566858928650618,
                    0.03715294972062111,
                    -0.02551816962659359,
                    0.020336611196398735,
                    0.008916284888982773,
                    -0.041929345577955246,
                    -0.06567540019750595,
                    0.07966876029968262,
                    0.04991542920470238,
                    0.046768173575401306,
                    0.01144135557115078,
                    0.014373557642102242,
                    0.003080290975049138,
                    -0.07897769659757614,
                    -0.007257040590047836,
                    0.04537105932831764,
                    0.02398747205734253,
                    -0.05545416101813316,
                    0.08159653097391129,
                    -0.007767649367451668,
                    -0.015049535781145096,
                    0.015815550461411476,
                    -0.021777404472231865,
                    -0.06380197405815125,
                    0.0368044413626194,
                    -0.02892390638589859,
                    0.09614156186580658,
                    0.07975474745035172,
                    0.05529720336198807,
                    0.008009218610823154,
                    -0.02717856504023075,
                    0.05490495637059212,
                    -0.08577887713909149,
                    0.02971487119793892,
                    0.031910765916109085,
                    -0.12435159087181091,
                    -0.02905585989356041,
                    -0.016782285645604134,
                    -0.014326062053442001,
                    -0.08672963082790375,
                    -0.018796082586050034,
                    -0.0023818467743694782,
                    -0.02719700150191784,
                    -0.023728277534246445,
                    -0.022877853363752365,
                    -0.0960826575756073,
                    -0.05513235926628113,
                    -0.00483306311070919,
                    0.05198448523879051,
                    -0.017580237239599228,
                    0.008856150321662426,
                    -0.002339952625334263,
                    -0.1308080554008484,
                    0.06506793946027756,
                    -0.030707605183124542,
                    -0.07148271799087524,
                    -0.06890308856964111,
                    -0.04337615892291069,
                    -0.015080028213560581,
                    0.07062295824289322,
                    2.5016901998268616e-33,
                    0.03920308127999306,
                    0.033642321825027466,
                    -0.051654331386089325,
                    0.04000101611018181,
                    0.06737284362316132,
                    0.0030422802083194256,
                    0.06258506327867508,
                    0.019136127084493637,
                    -0.06214001029729843,
                    -0.006954757962375879,
                    -0.015188133344054222,
                    0.026910416781902313,
                    0.021719859912991524,
                    -0.005364444572478533,
                    0.0742500051856041,
                    0.03970257565379143,
                    0.0054899039678275585,
                    0.051488544791936874,
                    0.04102366790175438,
                    -0.01272783987224102,
                    -0.03934603929519653,
                    -0.02025485411286354,
                    -0.027064817026257515,
                    -0.021567514166235924,
                    -0.004117276519536972,
                    0.05325550213456154,
                    0.0782138928771019,
                    -0.05998694896697998,
                    0.017801662907004356,
                    0.052480101585388184,
                    -0.04710688814520836,
                    -0.047010961920022964,
                    0.07654421776533127,
                    0.0412278026342392,
                    -0.12010553479194641,
                    0.06864438951015472,
                    0.16553042829036713,
                    0.010471133515238762,
                    0.024172354489564896,
                    -0.014566328376531601,
                    0.07887468487024307,
                    0.07859073579311371,
                    0.0586821511387825,
                    0.10067632049322128,
                    -0.020870480686426163,
                    -0.008189509622752666,
                    -0.05509649217128754,
                    0.037065956741571426,
                    -0.007314733229577541,
                    0.002968380693346262,
                    0.020431453362107277,
                    -0.035139743238687515,
                    -0.01687660813331604,
                    -0.04461793974041939,
                    -0.01917809620499611,
                    0.026030845940113068,
                    -0.09984595328569412,
                    0.0023097817320376635,
                    -0.048707347363233566,
                    0.023554107174277306,
                    -0.09303838014602661,
                    0.003459226107224822,
                    0.0463317334651947,
                    0.01399101223796606,
                    0.016214653849601746,
                    -0.0003813512739725411,
                    -0.038037944585084915,
                    -0.02965150587260723,
                    -0.05040491744875908,
                    -0.1019592359662056,
                    0.024997718632221222,
                    0.014434926211833954,
                    -0.08271868526935577,
                    0.024557868018746376,
                    -0.057955168187618256,
                    0.010566556826233864,
                    -0.060941554605960846,
                    0.0395377092063427,
                    -0.024169545620679855,
                    0.08722364157438278,
                    0.03877552971243858,
                    0.041772130876779556,
                    -0.0197567380964756,
                    0.03685871511697769,
                    0.03343683481216431,
                    -0.06339849531650543,
                    0.03482500836253166,
                    0.05595625936985016,
                    -0.04094638302922249,
                    -0.010175772942602634,
                    0.04539816826581955,
                    0.12253399938344955,
                    -0.030196379870176315,
                    0.03306921198964119,
                    -0.03408486768603325,
                    -1.1778297448472586e-08,
                    -0.0036352118477225304,
                    0.025681352242827415,
                    -0.033861517906188965,
                    0.0015316815115511417,
                    0.07500456273555756,
                    0.07352598011493683,
                    -0.04737160727381706,
                    -0.09122542291879654,
                    0.024491356685757637,
                    0.02272408828139305,
                    0.018415121361613274,
                    -0.019424287602305412,
                    -0.06391685456037521,
                    -0.03060770593583584,
                    0.012998826801776886,
                    -0.009283604100346565,
                    -0.03095264919102192,
                    -0.034080516546964645,
                    -0.03250721096992493,
                    0.04043911397457123,
                    0.02092519961297512,
                    0.0006359019898809493,
                    -0.09207238256931305,
                    -0.025302298367023468,
                    -0.03716487064957619,
                    0.00021879099949728698,
                    -0.04692693427205086,
                    0.07102522253990173,
                    0.024468109011650085,
                    0.08588848263025284,
                    0.09095776081085205,
                    0.08903853595256805,
                    -0.021884575486183167,
                    -0.06586926430463791,
                    -0.08354412019252777,
                    0.01909889094531536,
                    -0.016708269715309143,
                    -0.006484361365437508,
                    0.06199564412236214,
                    0.04940202087163925,
                    0.08490224927663803,
                    0.0851234570145607,
                    -0.03597958758473396,
                    0.02150847762823105,
                    -0.012405225075781345,
                    -0.08387023210525513,
                    0.0534195639193058,
                    -0.0770421028137207,
                    -0.02570851892232895,
                    -0.029274998232722282,
                    -0.021534567698836327,
                    0.014335163868963718,
                    0.048844631761312485,
                    0.0069734323769807816,
                    -0.014841540716588497,
                    0.006119552534073591,
                    0.005408997181802988,
                    0.016820775344967842,
                    -0.10914488881826401,
                    0.0705156996846199,
                    0.023921718820929527,
                    -0.006671799812465906,
                    0.08475527167320251,
                    -0.020674975588917732,
                ],
            },
            {
                "id": 1,
                "comment": "asda",
                "context": "stringTest",
                "vector": [
                    -0.03515147417783737,
                    -0.05847786366939545,
                    -0.1524566039443016,
                    0.05822881148196757,
                    -0.18799616396427155,
                    -0.0028631212189793587,
                    0.11132489889860153,
                    0.029092641547322273,
                    -0.08446335513144732,
                    -0.06890234164893627,
                    0.07678801566362381,
                    -0.0846653557382524,
                    -0.024232137948274612,
                    -0.06139083579182625,
                    -0.09849273040890694,
                    -0.02452616347000003,
                    0.09289713739417493,
                    -0.1418982595205307,
                    -0.09210193902254105,
                    -0.10768772289156914,
                    -0.024917387403547764,
                    0.025423115119338036,
                    -0.032276710495352745,
                    0.033496588468551636,
                    0.06583811901509762,
                    -0.04068407975137234,
                    -0.031394658610224724,
                    -0.0032146386802196503,
                    0.08946647867560387,
                    -0.205562774091959,
                    0.11411541514098644,
                    -0.031844316981732845,
                    0.09115221560932696,
                    0.07721342146396637,
                    0.0727289174683392,
                    -0.09832426812499762,
                    -0.011872685165144503,
                    -0.06336717493832111,
                    0.0025766100734472275,
                    -0.009675041073933244,
                    -0.04927929677069187,
                    -0.05533120222389698,
                    -0.02737381123006344,
                    0.027713467366993427,
                    -0.02591433748602867,
                    -0.046681083738803864,
                    -0.051334536634385586,
                    0.04099932499229908,
                    0.0985646490007639,
                    -0.020869728177785873,
                    -0.025997236545663327,
                    -0.03312863036990166,
                    -0.13752822950482368,
                    -0.052375306375324726,
                    -0.13153021596372128,
                    -0.027550952974706888,
                    0.013442106544971466,
                    -0.04245245747733861,
                    0.05914922058582306,
                    0.062116434797644615,
                    0.04234348330646753,
                    -0.0017862692475318909,
                    -0.0868932344019413,
                    0.12863561138510704,
                    0.056953415274620056,
                    -0.010315931402146816,
                    0.0841211243532598,
                    0.0335013666190207,
                    0.02589558798354119,
                    -0.12285485118627548,
                    -0.1259463056921959,
                    0.03001614660024643,
                    0.0005993396043777466,
                    0.18804479017853737,
                    0.04139513149857521,
                    0.05782068520784378,
                    0.028076852671802044,
                    -0.13964583724737167,
                    0.1284564696252346,
                    0.047160953283309937,
                    -0.03970834688516334,
                    -0.14466922357678413,
                    -0.0042822472751140594,
                    0.006546502932906151,
                    0.07006221916526556,
                    0.03225262090563774,
                    0.05764753930270672,
                    0.12425451725721359,
                    -0.03110191971063614,
                    0.010495476424694061,
                    0.035742504987865686,
                    -0.005010832101106644,
                    0.07820073142647743,
                    0.03347415622556582,
                    -0.007639901712536812,
                    0.07265924103558064,
                    0.045837320387363434,
                    -0.06816818844527006,
                    0.023173783905804157,
                    0.2827712595462799,
                    -0.04795925132930279,
                    0.04682490974664688,
                    0.05371737480163574,
                    0.02711471915245056,
                    -0.03762488625943661,
                    0.0020948052406311035,
                    0.09595839818939567,
                    -0.18872977048158646,
                    0.1596042774617672,
                    -0.064516874961555,
                    -0.035158791579306126,
                    0.003674287407193333,
                    -0.07104181498289108,
                    -0.046205706894397736,
                    0.05273139616474509,
                    -0.07187113165855408,
                    -0.04973530862480402,
                    0.07557147275656462,
                    -0.0757945291697979,
                    0.006642833352088928,
                    0.06346592772752047,
                    -0.037102461559697986,
                    -0.07718323543667793,
                    0.043559291400015354,
                    0.031683857552707195,
                    0.02070738677866757,
                    -0.046662405133247375,
                    -4.1941822108331534e-33,
                    0.035455893725156784,
                    0.021386653184890747,
                    0.0795406810939312,
                    -0.036224614828825,
                    -0.04757335036993027,
                    -0.045830635353922844,
                    -0.011015012860298157,
                    0.13965896447189152,
                    -0.0536862900480628,
                    0.03666252410039306,
                    -0.06815512431785464,
                    -0.03051699884235859,
                    0.013838589191436768,
                    -0.03565508872270584,
                    0.0822517592459917,
                    -0.003825722262263298,
                    0.05264635506318882,
                    0.03957525221630931,
                    -0.059179200790822506,
                    0.022940223570913076,
                    0.02225383440963924,
                    0.01174302026629448,
                    0.06902293674647808,
                    -0.11534669541288167,
                    -0.010981462895870209,
                    -0.14319519326090813,
                    0.006785260542528704,
                    -0.015386536717414856,
                    0.1343059502542019,
                    0.04344859765842557,
                    -0.0593236368149519,
                    -0.17722269892692566,
                    -0.1970229595899582,
                    0.13370503624901175,
                    0.10448772460222244,
                    -0.005161534994840622,
                    0.011909708380699158,
                    -0.057500340044498444,
                    -0.03189418837428093,
                    0.022232631221413612,
                    -0.10459897294640541,
                    -0.01738370582461357,
                    0.040304072201251984,
                    -0.01644185557961464,
                    -0.05040622875094414,
                    0.01106448844075203,
                    -0.07597875222563744,
                    0.017159995768452063,
                    0.02138294059841428,
                    0.02829555794596672,
                    -0.07577526196837425,
                    0.09752337448298931,
                    -0.1145116575062275,
                    0.06406555650755763,
                    -0.015140428440645337,
                    0.011670395731925964,
                    0.03836342738941312,
                    -0.029996754601597786,
                    0.12313700281083584,
                    0.21634004265069962,
                    -0.04831430967897177,
                    0.006590291857719421,
                    -0.013304128311574459,
                    0.07543819770216942,
                    -0.09601615741848946,
                    -0.01599038764834404,
                    0.03988184221088886,
                    -0.14368681982159615,
                    0.0707277711480856,
                    0.028322730213403702,
                    -0.1411733590066433,
                    -0.09713632985949516,
                    0.03911512717604637,
                    0.0034603020176291466,
                    -0.09469553083181381,
                    -0.024615590926259756,
                    -0.013475887943059206,
                    0.036466676741838455,
                    -0.13567088544368744,
                    -0.11959926411509514,
                    -0.009699750691652298,
                    -0.0344015434384346,
                    0.03259180532768369,
                    0.07582638040184975,
                    0.011690117418766022,
                    -0.056225940119475126,
                    0.031031088903546333,
                    -0.18007010221481323,
                    0.045142292976379395,
                    -0.11059598438441753,
                    -0.09323446452617645,
                    -0.023718626202025916,
                    0.03819899819791317,
                    -0.06644452922046185,
                    0.16550160199403763,
                    2.6671597182285668e-33,
                    -0.014799002557992935,
                    -0.05972205102443695,
                    -0.029192491434514523,
                    0.13700261153280735,
                    0.09196920320391655,
                    -0.03423829469829798,
                    0.23243039846420288,
                    0.09363333880901337,
                    -0.1039891354739666,
                    -0.02048313827253878,
                    0.05441374517977238,
                    0.024453881895169616,
                    -0.0085050193592906,
                    0.005524934269487858,
                    0.0680906642228365,
                    0.053475696477107704,
                    0.0685975831001997,
                    0.006772062741219997,
                    -0.007881026715040207,
                    -0.007289063418284059,
                    -0.041451489087194204,
                    0.13819867745041847,
                    0.01352884154766798,
                    -0.01778271177317947,
                    -0.07588841300457716,
                    0.03491118550300598,
                    0.07788659818470478,
                    -0.11711116507649422,
                    -0.04429895617067814,
                    0.07871725410223007,
                    0.08183987811207771,
                    0.08064033091068268,
                    -0.015412835404276848,
                    0.051365865394473076,
                    -0.12968341261148453,
                    0.06375330872833729,
                    0.2340097352862358,
                    -0.01535487174987793,
                    -0.017354309558868408,
                    0.05177779123187065,
                    0.19463178887963295,
                    0.17211509495973587,
                    -0.02966480329632759,
                    0.08956301864236593,
                    0.020528820110484958,
                    0.03237997740507126,
                    -0.1254258956760168,
                    0.1300288951024413,
                    0.09395290724933147,
                    -0.0050755999982357025,
                    -0.012949232012033463,
                    -0.023678023600950837,
                    0.09429259598255157,
                    -0.025893406942486763,
                    -0.00865689164493233,
                    0.007063516764901578,
                    0.01830461621284485,
                    -0.021955914446152747,
                    -0.06916322279721498,
                    0.01625494286417961,
                    -0.09567455621436238,
                    0.012119075283408165,
                    0.08311114832758904,
                    -0.03443329408764839,
                    -0.029734416864812374,
                    -0.08998675271868706,
                    -0.005287129431962967,
                    -0.034147864673286676,
                    -0.04845524299889803,
                    -0.033643608912825584,
                    -0.017366388346999884,
                    -0.06197915971279144,
                    -0.13439706340432167,
                    0.016275322530418634,
                    -0.0489213690161705,
                    -0.06485105119645596,
                    -0.1556914746761322,
                    -0.025427885120734572,
                    0.04455110989511013,
                    0.14502738416194916,
                    0.004468511790037155,
                    -0.06176872528158128,
                    0.005305357277393341,
                    0.21408003568649292,
                    0.06195815000683069,
                    0.02945215255022049,
                    0.11289344169199467,
                    0.05603198893368244,
                    -0.05065240617841482,
                    0.0040434596594423056,
                    0.0518014170229435,
                    0.053203217685222626,
                    -0.024313034024089575,
                    0.08476551901549101,
                    0.02825655322521925,
                    -2.415115840648241e-08,
                    -0.019156936556100845,
                    -0.03975899424403906,
                    0.04311291128396988,
                    0.00015015341341495514,
                    0.04263380356132984,
                    0.08654327737167478,
                    -0.11532288789749146,
                    -0.056404171511530876,
                    0.0717077674344182,
                    0.032716797199100256,
                    0.060089822858572006,
                    -0.033618660643696785,
                    -0.08672603778541088,
                    0.011117562651634216,
                    -0.02562832518015057,
                    -0.038311755284667015,
                    -0.06602911278605461,
                    0.01733192428946495,
                    -0.006117388606071472,
                    -0.042229779064655304,
                    -0.003181999083608389,
                    0.10779689997434616,
                    -0.029483371879905462,
                    0.037548189517110586,
                    0.011469129472970963,
                    0.04753171280026436,
                    0.0606433026259765,
                    0.2022588849067688,
                    0.06967227719724178,
                    0.05903224088251591,
                    0.1265909078065306,
                    0.06835129344835877,
                    -0.0029202252626419067,
                    -0.1972457841038704,
                    -0.03222457878291607,
                    0.03970163315534592,
                    0.096590057015419,
                    0.044949792325496674,
                    0.07411482185125351,
                    0.1574362814426422,
                    -0.02877986159728607,
                    0.11314935237169266,
                    -0.0041302405297756195,
                    -0.028923784149810672,
                    -0.009615086019039154,
                    -0.0262843519449234,
                    0.05026311241090298,
                    -0.05429580621421337,
                    -0.04184066317975521,
                    -0.08838313166052103,
                    -0.01935531571507454,
                    -0.026861489284783602,
                    -0.027962121181190014,
                    0.08941136300563812,
                    0.015668407082557678,
                    0.020236813463270664,
                    -0.09624536079354584,
                    -0.02321537397801876,
                    -0.17029474675655365,
                    0.08634161576628685,
                    0.13068898394703865,
                    -0.019420858938246965,
                    0.0435264278203249,
                    -0.04800077760592103,
                ],
            },
        ]
    }

    hierarcy_clustering(recordsList["data"])
